(function(t){function e(e){for(var n,a,o=e[0],c=e[1],h=e[2],u=0,d=[];u<o.length;u++)a=o[u],s[a]&&d.push(s[a][0]),s[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);l&&l(e);while(d.length)d.shift()();return r.push.apply(r,h||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],n=!0,o=1;o<i.length;o++){var c=i[o];0!==s[c]&&(n=!1)}n&&(r.splice(e--,1),t=a(a.s=i[0]))}return t}var n={},s={app:0},r=[];function a(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=n,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(i,n,function(e){return t[e]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/shinny-futures-web/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var h=0;h<o.length;h++)e(o[h]);var l=c;r.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},2568:function(t,e,i){},2770:function(t,e,i){},3170:function(t,e,i){},"3b91":function(t,e,i){"use strict";var n=i("6bfa"),s=i.n(n);s.a},"3e1c":function(t,e,i){"use strict";var n=i("819c"),s=i.n(n);s.a},"491c":function(t,e,i){},"55b5":function(t,e,i){"use strict";var n=i("2770"),s=i.n(n);s.a},"56d7":function(t,e,i){"use strict";i.r(e);i("fca0"),i("c5f6"),i("cadf"),i("551c"),i("097d");var n=i("2b0e"),s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Layout",{attrs:{id:"shinny-app"}},[i("Content",{staticClass:"content"},[i("Split",{attrs:{mode:"vertical"},model:{value:t.$root.appSplit,callback:function(e){t.$set(t.$root,"appSplit",e)},expression:"$root.appSplit"}},[i("div",{staticClass:"split-pane",attrs:{slot:"top"},slot:"top"},[i("router-view",{attrs:{name:"quotes"}})],1),i("div",{staticClass:"split-horizontal",attrs:{slot:"trigger"},slot:"trigger"},[i("div",{staticClass:"split-horizontal-dots"},[i("span",{staticClass:"dot"}),i("span",{staticClass:"dot"}),i("span",{staticClass:"dot"}),i("span",{staticClass:"dot"}),i("span",{staticClass:"dot"})])]),i("div",{staticClass:"split-pane",attrs:{slot:"bottom"},slot:"bottom"},[i("router-view",{attrs:{name:"user"}})],1)])],1)],1)},r=[],a=(i("7f7f"),{data:function(){return{isShowSettingModel:!1}},methods:{showSettingModel:function(){},onClickOk:function(){console.log("onClickOk")},onClickCancel:function(){console.log("onClickCancel")},onVisibleChange:function(t){console.log(t)}},computed:{isShowBackBtn:function(){return"charts"===this.$route.name}},beforeCreate:function(){},created:function(){},beforeMount:function(){},mounted:function(){this.$on("tqsdk:notify",function(t){"INFO"===t.level?"SETTLEMENT"===t.type?this.$store.commit("SET_SETTLEMENT",t):"MESSAGE"===t.type&&this.$Message.info(t.content):"WARNING"!==t.level&&"ERROR"!==t.level||this.$Message.error(t.content)})},beforeUpdate:function(){},updated:function(){},activated:function(){},deactivated:function(){},beforeDestroy:function(){},destroyed:function(){},errorCaptured:function(t,e,i){return console.error("App.errorCaptured",t,e,i),!1}}),o=a,c=(i("5c0b"),i("2877")),h=Object(c["a"])(o,s,r,!1,null,null,null);h.options.__file="App.vue";var l=h.exports,u=i("8c4f"),d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"quotes-container",staticStyle:{height:"100%"}},[i("SplitLeftRight",{attrs:{split:.8}},[i("template",{slot:"left"},[i("div",{staticClass:"top-content"},[i("ButtonsLine",{attrs:{tags:t.tags,defaultTag:t.defaultTag},on:{change:t.handlerChangeTag}})],1),i("div",{staticClass:"bottom-content",staticStyle:{top:"28px"}},[i("table-quotes",{attrs:{contentList:t.quotesList,tableCol:t.quotesTableRow,rootPath:t.rootPath}})],1)]),i("template",{slot:"right"},[i("div",{staticClass:"top-content"},[i("quote-info",{attrs:{instrumentId:t.instrumentId}})],1),i("div",{staticClass:"bottom-content",staticStyle:{top:"220px"}},[i("ticks-list",{attrs:{instrumentId:t.instrumentId}})],1)])],2)],1)},m=[],p=(i("a481"),i("be94")),f=i("2f62"),_=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tq-table-container",style:{height:"100%"},on:{scroll:t.handleScroll}},[i("table",{attrs:{id:"QuotesTable"}},[i("thead",[i("tr",t._l(t.tableCol,function(e,n){return i("td",{key:n},[i("div",{style:t.computeStyleObj(e)},[t._v(t._s(e["name"]))])])}),0)]),i("tbody",t._l(t.contentList,function(e){return i("table-row",{key:e,class:{selected:e===t.selectedSymbol},attrs:{symbol:e,path:t.rootPath+e+"/",tableCol:t.tableCol},on:{rowClick:t.rowClick,rowDbClick:t.rowDbClick}})}),1)])])},g=[],v=(i("6762"),i("2fdb"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("tr",{on:{click:t.handlerClick,dblclick:t.handlerDbClick}},[i("td",[i("div",[t._v(t._s(t.ins_id))])]),t._l(t.tableCol,function(e,n){return n>0?i("td",{key:n,class:t.classNameStr(e)},[i("div",{staticClass:"data-content",style:t.styleObj(e),attrs:{"data-content":t.formatter(e)}})]):t._e()})],2)}),b=[],y=(i("28a5"),i("4917"),{data:function(){return{priceDecs:0,priceTick:1,ins_id:"",ins_name:"",quote:{}}},components:{},props:{tableCol:{type:Array},symbol:{type:String},path:{type:String}},beforeMount:function(){this.quote=this.$tqsdk.get_quote(this.symbol),this.priceDecs=this.quote.price_decs,this.priceTick=this.quote.price_tick,this.ins_name=this.quote.ins_name;var t=this.symbol.match(/KQ\.[im]@([a-zA-Z]+)\.([a-zA-Z]+)/);t&&t[2]?("FUTURE_CONT"===this.quote.class&&(this.ins_id=t[2]+"主连 ("+this.quote.underlying_symbol.split(".")[1]+")"),"FUTURE_INDEX"===this.quote.class&&(this.ins_id=t[2]+"指数")):this.ins_id=this.quote.ins_id},mounted:function(){this.$on("tqsdk:rtn_data",function(){this.$tqsdk.is_changed(this.quote)&&this.$forceUpdate()})},methods:{classNameStr:function(t){return"function"===typeof t["className"]?this.quote?t["className"](this.quote):"":t["className"]},styleObj:function(t){var e={};return t["width"]&&(e["width"]=t["width"]+"px"),e},formatter:function(t){return t.formatter?t.formatter(this.quote):this.quote[t.prop]},handlerClick:function(){this.$emit("rowClick",this.quote)},handlerDbClick:function(){this.$emit("rowDbClick",this.quote)},handlerRowContextmenu:function(t){t.stopPropagation(),t.preventDefault(),this.$emit("rowContextmenu",this.quote)}}}),w=y,k=Object(c["a"])(w,v,b,!1,null,null,null);k.options.__file="TableQuotesRow.vue";var C=k.exports,S={data:function(){return{selectedSymbol:""}},components:{TableRow:C},props:{height:{type:String},tableCol:{type:Array},contentList:{type:Array},rootPath:{type:String}},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},mounted:function(){},beforeDestroy:function(){},computed:{},methods:{handleScroll:function(t){},computeStyleObj:function(t){var e={};return t["width"]&&(e["width"]=t["width"]+"px"),e},rowClick:function(t){this.$store.commit("SET_SELECTED_SHOW_SYMBOL",t.instrument_id),"FUTURE"===t.class?this.$store.commit("SET_SELECTED_SYMBOL",t.instrument_id):"FUTURE_CONT"===t.class&&this.$store.commit("SET_SELECTED_SYMBOL",t.underlying_symbol),this.selectedSymbol=t.instrument_id},rowDbClick:function(t){this.$router.push({name:"charts",params:{instrument_id:t.instrument_id}})},cellStyle:function(t){var e=t.row,i=t.column;t.rowIndex,t.columnIndex;return["最新价","涨跌","涨跌幅","今开盘","最高价","最低价"].includes(i.label)&&e.change%1===0&&0!==e.change?{color:e.change>0?"red":"green"}:{color:"black"}}}},x=S,E=(i("ab6f"),Object(c["a"])(x,_,g,!1,null,null,null));E.options.__file="Table.vue";var D=E.exports,T=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.quote?i("div",{staticClass:"quoteinfo-container"},[i("Row",[i("Col",{attrs:{span:"12"}},[i("div",[t._v(t._s(t.quote.ins_name))])]),i("Col",{attrs:{span:"12"}},[i("div",[t._v(t._s(t.instrumentId))])])],1),i("div",{staticClass:"contrast"},[i("Row",[i("Col",{attrs:{span:"6"}},[i("div",[t._v("卖一")])]),i("Col",{attrs:{span:"6"}},[i("div",[t._v(t._s(t.formatter(t.quote.ask_price1)))])]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t.quote.ask_volume1)+"\n\t\t\t")]),i("Col",{attrs:{span:"6"}})],1),i("div",{staticClass:"outer"},[i("div",{staticClass:"inner",style:{width:100*t.innerWidth+"%"}})]),i("Row",[i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t\t买一\n\t\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t.formatter(t.quote.bid_price1)))]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t.quote.bid_volume1))]),i("Col",{attrs:{span:"6"}})],1)],1),i("Row",[i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t最新价\n\t\t")]),i("Col",{class:t.classOfColor,attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t.formatter(t.quote.last_price))+"\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t昨结算\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t.formatter(t.quote.pre_settlement))+"\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t涨跌\n\t\t")]),i("Col",{class:t.classOfColor,attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t.formatter(t.quote.change))+"\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t今开\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t.quote.open)+"\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t涨跌幅\n\t\t")]),i("Col",{class:t.classOfColor,attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t._f("toPercent")(t.quote.change_percent))+"%\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t最高\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t.formatter(t.quote.highest))+"\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t总手\n\t\t")]),i("Col",{class:t.classOfColor,attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t.quote.volume)+"\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t最低\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t.formatter(t.quote.lowest))+"\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t涨停\n\t\t")]),i("Col",{staticClass:"R",attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t.formatter(t.quote.upper_limit))+"\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t收盘\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t.formatter(t.quote.close))+"\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t跌停\n\t\t")]),i("Col",{staticClass:"G",attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t.formatter(t.quote.lower_limit))+"\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t结算\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t\t"+t._s(t.formatter(t.quote.settlement))+"\n\t\t")])],1),i("Row",[i("Col",{attrs:{span:"6"}},[t._v("\n\t\t持仓量\n\t\t")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t"+t._s(t.quote.open_interest))]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t日增")]),i("Col",{attrs:{span:"6"}},[t._v("\n\t\t"+t._s(t.quote.open_interest-t.quote.pre_open_interest))])],1)],1):t._e()},q=[],O=i("53ca");i("f576");function I(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return"number"===typeof t?t.toFixed(e):t}function $(t){var e=null;if("number"===typeof t){e=t>1e12&&t<3e12?new Date(t):new Date(t/1e6);var i=e.getFullYear()+"",n=(e.getMonth()+1+"").padStart(2,"0"),s=(e.getDate()+"").padStart(2,"0"),r=(e.getHours()+"").padStart(2,"0"),a=(e.getMinutes()+"").padStart(2,"0"),o=(e.getSeconds()+"").padStart(2,"0"),c=(e.getMilliseconds()+"").padStart(3,"0");return i+"/"+n+"/"+s+"-"+r+":"+a+":"+o+"."+c}return e}function M(t){switch(t){case"BUY":return"买";case"SELL":return"卖";default:return t}}function N(t){switch(t){case"OPEN":return"开";case"CLOSE":return"平昨";case"CLOSETODAY":return"平今";default:return t}}function P(t,e,i,n){if("object"===Object(O["a"])(t)&&Array.isArray(e)){for(var s=[],r=0;r<e.length;r++){var a=e[r],o="string"===typeof i?i:i(a),c=e[r][o];t.hasOwnProperty(c)&&n(a)?(e[r]=t[c],s.push(c)):e.splice(r--,1)}for(var h in t)if(!s.includes(h)){var l=t[h];n(l)&&e.push(l)}}}var j={data:function(){return{quote:this.$tqsdk.get_quote(this.instrumentId)}},mounted:function(){this.$on("tqsdk:rtn_data",this.update)},watch:{instrumentId:{handler:function(t,e){this.quote=this.$tqsdk.get_quote(t)},immediate:!0}},props:{instrumentId:String},computed:{classOfColor:function(){return this.quote["change"]>0?"R":this.quote["change"]<0?"G":""},innerWidth:function(){return this.quote.bid_volume1/(this.quote.bid_volume1+this.quote.ask_volume1)}},methods:{formatter:function(t){return I(t,this.quote.price_decs)},update:function(){this.quote=this.$tqsdk.get_quote(this.instrumentId),this.$forceUpdate()}}},L=j,A=(i("c107"),Object(c["a"])(L,T,q,!1,null,"00cc2aa8",null));A.options.__file="QuoteInfo.vue";var F=A.exports,R=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"tickslist-container",style:{height:t.height}},[i("table",[t._m(0),t.quote?i("tbody",t._l(t.ticks,function(e,n){return i("tr",{key:n},[i("td",[t._v(t._s(e.dt))]),i("td",{class:e.textColor},[t._v(t._s(e.price))]),i("td",{class:e.textColor},[t._v(t._s(e.vol))]),i("td",[t._v(t._s(e.oi))]),i("td",{class:e.textColor},[t._v(t._s(e.msg))])])}),0):t._e()])])},W=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("thead",[i("tr",[i("td",[t._v("时间")]),i("td",[t._v("价位")]),i("td",[t._v("现手")]),i("td",[t._v("增仓")]),i("td",[t._v("开平")])])])}],H={data:function(){return{ticks:[],quote:this.$tqsdk.get_quote(this.instrument_id)}},mounted:function(){this.$on("tqsdk:rtn_data",function(){var t=this.$tqsdk.dm.getTicks(this.instrumentId);t.last_id>0&&this.update()})},watch:{instrumentId:{handler:function(t,e){this.$tqsdk.set_chart({chart_id:"ticks_chart",symbol:t,duration:0}),this.quote=this.$tqsdk.get_quote(t),this.ticks.splice(0)},immediate:!0}},props:{instrumentId:String,height:String},methods:{genOneTick:function(t,e){var i=e[t],n=e[t-1];if(this.quote&&i&&n&&i.volume-n.volume>0){var s=i.volume-n.volume,r=i.open_interest-n.open_interest,a={datetime:i.datetime,dt:$(i.datetime).slice(11,19),price:I(i.last_price,this.quote.price_decs),vol:s,oi:r,msg:"",textColor:""},o=i.last_price-n.last_price,c=0;switch(c=i.last_price>=n.ask_price1?1:i.last_price<=n.bid_price1?-1:o>0?1:o<0?-1:0,a.msg=r>0&&r===s?"双开":r<0&&r+s===0?"双平":0===c?"换手":(c>0?"多":"空")+(r>0?"开":r<0?"平":"换"),a.msg){case"双开":case"双平":a.textColor=1===c?"R":-1===c?"G":"";break;case"多开":case"多换":case"空平":a.textColor="R";break;case"空开":case"空换":case"多平":a.textColor="G";break;default:a.textColor="";break}return a}return null},update:function(){var t=this.$tqsdk.dm.getTicks(this.instrumentId),e=50,i=0;if(0===this.ticks.length){this.last_id=t.last_id;for(var n=t.last_id;n>=0;n--){var s=this.genOneTick(n,t);if(null!==s&&(this.$set(this.ticks,i,s),i++,i===e))break}}else if(this.last_id<t.last_id){var r=this.genOneTick(t.last_id,t);null!==r&&r.datetime>this.ticks[0].datetime&&this.ticks.splice(0,0,r)}}}},G=H,B=(i("3e1c"),Object(c["a"])(G,R,W,!1,null,"b9110f28",null));B.options.__file="TicksList.vue";var U=B.exports,Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Split",{staticClass:"split-container",model:{value:t.this_split,callback:function(e){t.this_split=e},expression:"this_split"}},[i("div",{staticClass:"split-pane left",attrs:{slot:"left"},slot:"left"},[t._t("left")],2),i("div",{staticClass:"split-vertical",attrs:{slot:"trigger"},slot:"trigger"},[i("div",{staticClass:"split-vertical-dots"},[i("span",{staticClass:"dot"}),i("span",{staticClass:"dot"}),i("span",{staticClass:"dot"}),i("span",{staticClass:"dot"}),i("span",{staticClass:"dot"})])]),i("div",{staticClass:"split-pane right",attrs:{slot:"right"},slot:"right"},[t._t("right")],2)])},Z=[],z={data:function(){return{this_split:.5}},created:function(){this.this_split=this.split},props:{split:{type:Number}}},J=z,Q=(i("966f"),Object(c["a"])(J,Y,Z,!1,null,null,null));Q.options.__file="SplitLeftRight.vue";var X=Q.exports,V=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"row"},[i("div",t._l(t.tags,function(e,n){return i("div",{key:n,staticClass:"col"},[i("Button",{attrs:{size:"small",type:t.type(e)},on:{click:function(i){t.handlerClickTag(e)}}},[t._v("\n\t\t\t\t"+t._s(e)+"\n\t\t\t")])],1)}),0)])},K=[],tt={name:"ButtonsLine",data:function(){return{selectedTag:this.defaultTag?this.defaultTag:this.tags[0]}},props:{tags:{type:Array,required:!0,validator:function(t){return t.length>0}},defaultTag:String},methods:{type:function(t){return t===this.selectedTag?"primary":"default"},handlerClickTag:function(t){this.selectedTag=t,this.$emit("change",t)}}},et=tt,it=(i("f6c8"),Object(c["a"])(et,V,K,!1,null,"225e0c12",null));it.options.__file="ButtonsLine.vue";var nt=it.exports,st={bid:"快期模拟"};var rt=[{name:"合约代码",prop:"instrument_id",width:80},{name:"合约中文名",prop:"ins_name",width:70},{name:"最新价",prop:"last_price",width:60,className:function(t){return t["change"]>0?"R":t["change"]<0?"G":""},formatter:function(t){return I(t["last_price"],t["price_decs"])}},{name:"买价",prop:"bid_price1",width:60,className:"col-buy",formatter:function(t){return I(t["bid_price1"],t["price_decs"])}},{name:"买量",prop:"bid_volume1",width:60,className:"col-buy"},{name:"卖价",prop:"ask_price1",width:60,className:"col-sell",formatter:function(t){return I(t["ask_price1"],t["price_decs"])}},{name:"卖量",prop:"ask_volume1",width:60,className:"col-sell"},{name:"涨跌",prop:"change",width:60,className:function(t){return t["change"]>0?"R":t["change"]<0?"G":""},formatter:function(t){return I(t["change"],t["price_decs"])}},{name:"涨跌幅",prop:"change_percent",width:60,className:function(t){return t["change"]>0?"R":t["change"]<0?"G":""},formatter:function(t){var e=I(t["change"]/t["pre_settlement"]*100,2);return isNaN(e)?"-":e+"%"}},{name:"成交量",prop:"volume",width:60,className:function(t){return t["change"]>0?"R":t["change"]<0?"G":""}},{name:"持仓量",prop:"open_interest",width:60},{name:"涨停价",prop:"upper_limit",width:60,formatter:function(t){return I(t["upper_limit"],t["price_decs"])}},{name:"跌停价",prop:"lower_limit",width:60,formatter:function(t){return I(t["lower_limit"],t["price_decs"])}},{name:"今开盘",prop:"open",width:60,formatter:function(t){return I(t["open"],t["price_decs"])}},{name:"最低价",prop:"lowest",width:60,formatter:function(t){return I(t["lowest"],t["price_decs"])}},{name:"最高价",prop:"highest",width:60,formatter:function(t){return I(t["highest"],t["price_decs"])}},{name:"昨收盘",prop:"pre_close",width:60,formatter:function(t){return I(t["pre_close"],t["price_decs"])}},{name:"昨结算",prop:"pre_settlement",width:60,formatter:function(t){return I(t["pre_settlement"],t["price_decs"])}},{name:"行情更新时间",prop:"datetime",width:80,formatter:function(t){return t["datetime"]?t["datetime"].slice(11,19):""}},{name:"合约乘数",prop:"volume_multiple",width:60},{name:"最小价位",prop:"price_tick",width:60},{name:"最后交易日",prop:"expire_datetime",width:70,formatter:function(t){return t["expire_datetime"]?$(1e3*t["expire_datetime"]).slice(0,10):""}}],at={name:"quotes",components:{TableQuotes:D,QuoteInfo:F,TicksList:U,SplitLeftRight:X,ButtonsLine:nt},data:function(){var t=this.$route.params.tag;return{defaultTag:t,tags:this.$store.state.tags,quotesTableRow:rt,rootPath:"quotes/",selectedTab:"quoteInfo"}},computed:Object(p["a"])({quotesList:function(){var t=this.$store.state.tagsQuotesMap[this.$route.params.tag];return t&&this.$tqsdk.subscribe_quote(t),t},rowWidth:function(){var t=this.$store.state.tags.join("").length,e=this.$store.state.tags.length;return 12.5*t+20*e}},Object(f["b"])({instrumentId:"getSelectedShowInstrumentId"})),methods:{handlerChangeTag:function(t){this.$router.replace({name:"quotes",params:{tag:t}})}}},ot=at,ct=(i("9bac"),Object(c["a"])(ot,d,m,!1,null,"5eb45f78",null));ct.options.__file="Quotes.vue";var ht=ct.exports,lt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{height:"100%"}},[i("confirm"),t.$store.state.logined?i("trade"):i("login")],1)},ut=[],dt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"user-trade"},[i("SplitLeftRight",{attrs:{split:t.split}},[i("template",{slot:"left"},[i("Form",{attrs:{"label-width":60}},[i("FormItem",{attrs:{label:"合约"}},[i("AutoComplete",{staticStyle:{width:"200px"},attrs:{clearable:"",data:t.searchResult,placeholder:"请输入合约"},on:{"on-search":t.querySearch},model:{value:t.instrumentId,callback:function(e){t.instrumentId=e},expression:"instrumentId"}})],1),i("FormItem",{attrs:{label:"手数"}},[i("InputNumber",{staticStyle:{width:"200px"},attrs:{min:1},model:{value:t.volume,callback:function(e){t.volume=e},expression:"volume"}})],1),i("FormItem",{attrs:{label:"价格"}},[i("InputNumber",{staticStyle:{width:"200px"},attrs:{max:t.maxPrice,min:t.minPrice,step:t.priceTick},model:{value:t.limitPrice,callback:function(e){t.limitPrice=e},expression:"limitPrice"}})],1),i("FormItem",[i("Button",{on:{click:function(e){t.insertOrder("BUY","OPEN")}}},[t._v("买开")]),i("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(e){t.insertOrder("SELL","OPEN")}}},[t._v("卖开")])],1),i("FormItem",[i("Button",{on:{click:function(e){t.insertOrder("BUY","CLOSE")}}},[t._v("买平")]),i("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(e){t.insertOrder("SELL","CLOSE")}}},[t._v("卖平")])],1)],1)],1),i("template",{slot:"right"},[i("Tabs",{attrs:{type:"card",animated:!1},model:{value:t.selectedTab,callback:function(e){t.selectedTab=e},expression:"selectedTab"}},[i("TabPane",{attrs:{label:"账户",name:"accounts"}},[i("table-accounts")],1),i("TabPane",{attrs:{label:"持仓",name:"positions"}},[i("table-positions",{attrs:{height:t.height}})],1),i("TabPane",{attrs:{label:"委托单",name:"orders"}},[i("table-orders",{attrs:{height:t.height}})],1),i("TabPane",{attrs:{label:"成交记录",name:"trades"}},[i("table-trades",{attrs:{height:t.height}})],1)],1)],1)],2)],1)},mt=[],pt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"accounts-container"},[i("Table",{attrs:{columns:t.columns1,data:[t.account]}}),i("Table",{attrs:{columns:t.columns2,data:[t.account]}})],1)},ft=[],_t={data:function(){var t={balance:"账户权益",available:"可用资金",pre_balance:"账户权益",deposit:"入金金额",withdraw:"出金金额",commission:"手续费",premium:"权利金",static_balance:"静态权益",position_profit:"持仓盈亏",float_profit:"浮动盈亏",risk_ratio:"风险度",margin:"占用资金",frozen_margin:"冻结保证金",frozen_commission:"冻结手续费",frozen_premium:"冻结权利金",close_profit:"平仓盈亏"};return{columns1:[{title:t["balance"],key:"balance",align:"right",render:function(t,e){return t("div",I(e.row.balance))}},{title:t["available"],key:"available",align:"right",render:function(t,e){return t("div",I(e.row.available))}},{title:t["pre_balance"],key:"pre_balance",align:"right",render:function(t,e){return t("div",I(e.row.pre_balance))}},{title:t["deposit"],key:"deposit",align:"right",render:function(t,e){return t("div",I(e.row.deposit))}},{title:t["withdraw"],key:"withdraw",align:"right",render:function(t,e){return t("div",I(e.row.withdraw))}},{title:t["commission"],key:"commission",align:"right",render:function(t,e){return t("div",I(e.row.commission))}}],columns2:[{title:t["static_balance"],key:"static_balance",align:"right",render:function(t,e){return t("div",I(e.row.static_balance))}},{title:t["position_profit"],key:"position_profit",align:"right",render:function(t,e){return t("div",I(e.row.position_profit))}},{title:t["float_profit"],key:"float_profit",align:"right",render:function(t,e){return t("div",I(e.row.float_profit))}},{title:t["close_profit"],key:"close_profit",align:"right",render:function(t,e){return t("div",I(e.row.close_profit))}},{title:t["margin"],key:"margin",align:"right",render:function(t,e){return t("div",I(e.row.margin))}},{title:t["risk_ratio"],key:"risk_ratio",align:"right",render:function(t,e){return t("div",I(e.row.risk_ratio)+"%")}}]}},created:function(){this.account=this.$tqsdk.get_account(),this.$on("tqsdk:rtn_data",function(){this.$tqsdk.is_changed(this.account)&&this.$forceUpdate()})}},gt=_t,vt=(i("c942"),Object(c["a"])(gt,pt,ft,!1,null,"09c04a98",null));vt.options.__file="TableAccounts.vue";var bt=vt.exports,yt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Table",{attrs:{height:t.height,columns:t.columns,data:t.positionsArr}})},wt=[],kt={data:function(){return{positionsArr:[],columns:[{title:"合约代码",key:"instrument_id",width:80,fixed:"left"},{title:"最新价",key:"last_price",width:80,align:"right",fixed:"left"},{title:"多仓",key:"volume_long",width:50,align:"right",className:"col-buy"},{title:"开仓均价",key:"open_price_long",width:80,align:"right",className:"col-buy",render:this.formatterPrice},{title:"持仓盈亏",key:"position_profit_long",width:80,align:"right",className:"col-buy",render:this.formatterPrice},{title:"操作",key:"action",width:150,align:"center",className:"col-buy",render:this.genButtons},{title:"空仓",key:"volume_short",width:50,align:"right",className:"col-sell"},{title:"开仓均价",key:"open_price_short",width:80,align:"right",className:"col-sell",render:this.formatterPrice},{title:"持仓盈亏",key:"position_profit_short",width:80,align:"right",className:"col-sell",render:this.formatterPrice},{title:"操作",key:"action",width:150,align:"center",className:"col-sell",render:this.genButtons},{title:"持仓占用",key:"margin",width:80,align:"right",render:this.formatterPrice}]}},props:{height:{type:String},loading:{type:Boolean,default:!1}},mounted:function(){this.$on("tqsdk:rtn_data",function(){var t=this.$tqsdk.get_positions();t&&this.$tqsdk.is_changed(t)&&P(t,this.positionsArr,function(t){return["exchange_id"]+"."+t["instrument_id"]},function(t){return t.volume_long>0||t.volume_short>0})})},methods:{formatterPrice:function(t,e){return t("div",I(e.row[e.column.key]))},genButtons:function(t,e){var i=this,n="col-buy"===e.column.className?"success":"error",s="col-buy"===e.column.className?"SELL":"BUY",r="col-buy"===e.column.className?e.row.volume_long:e.row.volume_short,a=[t("Button",{props:{type:n,size:"small"},style:{marginRight:"5px"},on:{click:function(){i.handleClose(e.index,e.row,s)}}},"平仓"),t("Button",{props:{type:n,size:"small"},style:{marginRight:"5px"},on:{click:function(){i.handleCloseOpen(e.index,e.row,s)}}},"反手")];return t("div",r>0?a:[])},handleClose:function(t,e,i){var n="BUY"===i?e.volume_short:e.volume_long;this.$tqsdk.insert_order({exchange_id:e.exchange_id,ins_id:e.instrument_id,direction:i,offset:"CLOSE",limit_price:e.last_price,volume:n})},handleCloseOpen:function(t,e,i){var n="BUY"===i?e.volume_short:e.volume_long;this.$tqsdk.insert_order({exchange_id:e.exchange_id,ins_id:e.instrument_id,direction:i,offset:"CLOSE",limit_price:e.last_price,volume:n}),this.$tqsdk.insert_order({exchange_id:e.exchange_id,ins_id:e.instrument_id,direction:i,offset:"OPEN",limit_price:e.last_price,volume:n})},rowClick:function(t,e,i){var n=t.exchange_id+"."+t.instrument_id;this.$store.commit("SET_SELECTED_SYMBOL",n)}}},Ct=kt,St=Object(c["a"])(Ct,yt,wt,!1,null,null,null);St.options.__file="TablePositions.vue";var xt=St.exports,Et=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Table",{attrs:{height:t.height,columns:t.columns,data:t.ordersArr}})},Dt=[],Tt={data:function(){var t=this;return{ordersArr:[],columns:[{title:"委托单ID",key:"order_id",width:180,fixed:"left"},{title:"合约代码",key:"instrument_id",width:70,align:"center"},{title:"方向",key:"direction",width:50,align:"center",render:function(t,e){return t("div",M(e.row.direction))}},{title:"开平",key:"offset",width:50,align:"center",render:function(t,e){return t("div",N(e.row.offset))}},{title:"手数",key:"volume_orign",width:50,align:"right"},{title:"价格",key:"limit_price",width:70,align:"right"},{title:"未成交",key:"volume_left",width:60,align:"right"},{title:"操作",key:"action",width:80,align:"center",render:function(e,i){var n=e("Button",{props:{size:"small"},style:{marginRight:"5px"},on:{click:function(){t.handleCancelOrder(i.index,i.row)}}},"撤单");return"ALIVE"===i.row.status?e("div",[n]):e("div",[])}},{title:"状态",key:"status",width:100,align:"center",render:function(t,e){return"FINISHED"===e.row.status?t("div","已完成"):t("div","未完成")}},{title:"下单时间",key:"insert_date_time",width:160,align:"right",render:function(t,e){return t("div",$(e.row.insert_date_time))}},{title:"提示",key:"last_msg",width:180,align:"right"}]}},props:{height:{type:String}},mounted:function(){this.$on("tqsdk:rtn_data",function(){var t=this.$tqsdk.get_orders();this.$tqsdk.is_changed(t)&&P(t,this.ordersArr,"order_id",function(){return 1})})},methods:{filterStatus:function(t,e){return e.status===t},handleCancelOrder:function(t,e){this.$tqsdk.cancel_order(e.order_id)},rowClick:function(t,e,i){var n=t.exchange_id+"."+t.instrument_id;this.$store.commit("SET_SELECTED_SYMBOL",n)}}},qt=Tt,Ot=Object(c["a"])(qt,Et,Dt,!1,null,null,null);Ot.options.__file="TableOrders.vue";var It=Ot.exports,$t=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Table",{attrs:{height:t.height,columns:t.columns,data:t.tradesArr}})},Mt=[],Nt={data:function(){return{tradesArr:[],columns:[{title:"委托单ID",key:"order_id",width:180,fixed:"left"},{title:"交易所单号",key:"exchange_trade_id",width:100,align:"left"},{title:"合约代码",key:"instrument_id",width:100,align:"left"},{title:"方向",key:"direction",width:50,align:"center",render:function(t,e){return t("div",M(e.row.direction))}},{title:"开平",key:"offset",width:50,align:"center",render:function(t,e){return t("div",N(e.row.offset))}},{title:"手数",key:"volume",width:50,align:"right"},{title:"价格",key:"price",width:70,align:"right",render:function(t,e){return t("div",I(e.row.price))}},{title:"时间",key:"trade_date_time",width:160,align:"right",render:function(t,e){return t("div",$(e.row.trade_date_time))}},{title:"手续费",key:"commission",width:80,align:"right"}]}},props:{height:{type:String}},mounted:function(){this.$on("tqsdk:rtn_data",function(){var t=this.$tqsdk.get_trades();this.$tqsdk.is_changed(t)&&P(t,this.tradesArr,"trade_id",function(){return 1})})},methods:{filterInstrumentId:function(t,e){return e.instrument_id===t}}},Pt=Nt,jt=Object(c["a"])(Pt,$t,Mt,!1,null,null,null);jt.options.__file="TableTrades.vue";var Lt=jt.exports,At={components:{TableAccounts:bt,TablePositions:xt,TableOrders:It,TableTrades:Lt,SplitLeftRight:X},data:function(){return{split:.3,instrumentId:"",searchResult:[],selectedTab:"accounts",volume:1,priceTick:1,limitPrice:0,priceDecs:0,maxPrice:1/0,minPrice:0}},mounted:function(){var t=this;this.$store.subscribe(function(e,i){if("SET_SELECTED_SYMBOL"===e.type){var n=t.$tqsdk.get_quote(e.payload);t.instrumentId=e.payload,n&&(t.priceTick=Number(n.price_tick),t.limitPrice=Number(n.last_price),t.priceDecs=Number(n.price_decs),t.maxPrice=0===n.upper_limit?1/0:Number(n.upper_limit),t.minPrice=0===n.lower_limit?0:Number(n.lower_limit))}})},computed:{height:function(){return this.$root.windowHeight*(1-this.$root.appSplit)-44+""}},methods:{querySearch:function(t,e){this.$tqsdk.quotesInfo.hasOwnProperty(t)?this.searchResult=null:this.searchResult=this.$tqsdk.get_quotes_by_input(t)},handleSelectInstrument:function(t){},insertOrder:function(t,e){var i=this.$tqsdk.get_quote(this.instrumentId);this.$tqsdk.insert_order({exchange_id:i.exchange_id,ins_id:i.ins_id,direction:t,offset:e,limit_price:this.limitPrice,volume:this.volume})}}},Ft=At,Rt=(i("e86d"),Object(c["a"])(Ft,dt,mt,!1,null,null,null));Rt.options.__file="UserTrade.vue";var Wt=Rt.exports,Ht=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"user-login"},[t.showLoginError?i("Alert",{attrs:{type:"error","show-icon":"",closable:""},on:{"on-close":t.onclose}},[t._v("\n\t\t"+t._s(t.errorMsg)+"\n\t")]):t._e(),i("Form",{ref:"userForm",attrs:{model:t.userForm,rules:t.rules,"label-width":80}},[i("FormItem",{attrs:{label:"期货公司",prop:"bid"}},[i("Select",{model:{value:t.userForm.bid,callback:function(e){t.$set(t.userForm,"bid",e)},expression:"userForm.bid"}},t._l(t.brokers,function(e){return i("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])}),1)],1),i("FormItem",{attrs:{label:"账号",prop:"user_name"}},[i("Input",{attrs:{placeholder:"请输入账号"},model:{value:t.userForm.user_name,callback:function(e){t.$set(t.userForm,"user_name",e)},expression:"userForm.user_name"}})],1),i("FormItem",{attrs:{label:"密码",prop:"password"}},[i("Input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:t.userForm.password,callback:function(e){t.$set(t.userForm,"password",e)},expression:"userForm.password"}})],1),i("FormItem",[i("Button",{attrs:{loading:t.loading,type:"primary"},on:{click:function(e){t.onSubmit("userForm")}}},[t._v("\n\t\t\t\t登录\n\t\t\t")])],1)],1)],1)},Gt=[],Bt=(i("f751"),"等待回应超时,可能的原因 (1)服务器正在运维，(2)网络不通，无法连接服务器，请稍后/检查网络后重试。"),Ut={name:"userLogin",data:function(){return{brokers:[],errorMsg:Bt,userForm:Object.assign({bid:"",user_name:"",password:""},st),rules:{bid:[{required:!0,message:"请选择期货公司",trigger:"blur"}],user_name:[{required:!0,message:"请输入账户",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},loading:!1,showLoginError:!1}},mounted:function(){this.$on("tqsdk:rtn_brokers",function(t){this.brokers=t})},methods:{onclose:function(){this.showLoginError=!1},onSubmit:function(t){var e=this;this.loading=!0,this.$refs[t].validate(function(t){if(t){e.$tqsdk.login({bid:e.userForm.bid,user_id:e.userForm.user_name,password:e.userForm.password});var i=setTimeout(function(){this.$tqsdk.is_logined()||(this.loading=!1,this.showLoginError=!0,this.errorMsg=Bt)}.bind(e),1e4);e.$on("tqsdk:rtn_data",function(){this.$tqsdk.is_logined()&&(this.loading=!1,this.showLoginError=!1,this.$store.commit("SET_LOGIN",!0),clearTimeout(i))}),e.$on("tqsdk:notify",function(t){"WARNING"!==t.level&&"ERROR"!==t.level||(this.loading=!1,this.showLoginError=!0,this.errorMsg=t.content)})}})}}},Yt=Ut,Zt=(i("55b5"),Object(c["a"])(Yt,Ht,Gt,!1,null,null,null));Zt.options.__file="UserLogin.vue";var zt=Zt.exports,Jt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Modal",{attrs:{title:"确认结算单",closable:!1,"mask-closable":!1},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[i("div",{staticClass:"confirm-container"},[i("pre",[t._v(t._s(t.confirmContent))])]),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"primary"},on:{click:t.clickOk}},[t._v("确定")])],1)])},Qt=[],Xt={computed:{visible:function(){return"doing"===this.$store.state.confirm},confirmContent:function(){return this.$store.state.confirmContent}},methods:{clickOk:function(){this.$tqsdk.confirm_settlement(),this.$store.commit("SET_SETTLEMENT",{confirm:"done",confirmContent:""})}}},Vt=Xt,Kt=(i("bfab"),Object(c["a"])(Vt,Jt,Qt,!1,null,"0936c424",null));Kt.options.__file="UserConfirmSettlement.vue";var te=Kt.exports,ee={name:"user",components:{Trade:Wt,Login:zt,Confirm:te}},ie=ee,ne=Object(c["a"])(ie,lt,ut,!1,null,null,null);ne.options.__file="User.vue";var se=ne.exports,re=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"charts-container"},[i("Chart",{attrs:{instrumentId:t.instrumentId,height:t.height}})],1)},ae=[],oe=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"chart",style:{height:t.height+"px"}},[i("Tooltip",{attrs:{content:"返回(Esc)",placement:"right-end"}},[i("Button",{attrs:{shape:"circle",icon:"md-return-left"},on:{click:t.goBack}})],1),t._v("\n\n\t \n\n\t"),i("RadioGroup",{attrs:{size:"small",type:"button"},model:{value:t.selectedPeriod,callback:function(e){t.selectedPeriod=e},expression:"selectedPeriod"}},t._l(t.periods,function(e){return i("Radio",{key:e,attrs:{label:e}},[t._v("\n\t\t\t"+t._s(e)+"\n\t\t")])}),1),t._v("\n\t \n\t"),i("Checkbox",{attrs:{label:"ma"},on:{"on-change":function(e){t.onchange("ma3")}},model:{value:t.indicators.ma3.show,callback:function(e){t.$set(t.indicators.ma3,"show",e)},expression:"indicators.ma3.show"}},[t._v("MA3")]),i("Checkbox",{attrs:{label:"ma"},on:{"on-change":function(e){t.onchange("ma10")}},model:{value:t.indicators.ma10.show,callback:function(e){t.$set(t.indicators.ma10,"show",e)},expression:"indicators.ma10.show"}},[t._v("MA10")]),i("Checkbox",{attrs:{label:"ma"},on:{"on-change":function(e){t.onchange("ma30")}},model:{value:t.indicators.ma30.show,callback:function(e){t.$set(t.indicators.ma30,"show",e)},expression:"indicators.ma30.show"}},[t._v("MA30")]),i("Checkbox",{attrs:{label:"boll"},on:{"on-change":function(e){t.onchange("boll")}},model:{value:t.indicators.boll.show,callback:function(e){t.$set(t.indicators.boll,"show",e)},expression:"indicators.boll.show"}},[t._v("BOLL")]),i("Dropdown",{on:{"on-click":t.onSelectedItem}},[i("a",{attrs:{href:"javascript:void(0)"}},[t._v("\n\t\t\tK线样式("+t._s(t.selectedItem)+")\n\t\t\t"),i("Icon",{attrs:{type:"ios-arrow-down"}})],1),i("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[i("DropdownItem",{attrs:{name:"candle",selected:"candle"===t.selectedItem}},[t._v("Candles")]),i("DropdownItem",{attrs:{name:"ohlc",selected:"ohlc"===t.selectedItem}},[t._v("Bars")])],1)],1),i("div",{ref:"CHART",style:{height:t.height-30+"px"},attrs:{id:"CHART"}})],1)},ce=[],he=(i("ac6a"),i("456d"),i("673e"),i("d4ec")),le=i("bee2"),ue=i("ade3"),de=i("5698"),me="web_kline_chart",pe=.1,fe=13,_e=55,ge=3,ve=function(){function t(e){Object(he["a"])(this,t),this.tqsdk=e.tqsdk,this.mainType="candle",this._symbol=e.symbol?e.symbol:null,this._duration=e.duration?e.duration:null,this._width=e.width?e.width:null,this._barWidth=fe,this._barPadding=Math.max(1,Math.round(this._barWidth*pe)),this._barNumbers=Math.floor(this._width/this._barWidth),this._left_id=-1,this._right_id=-1,this.sendToServer()}return Object(le["a"])(t,[{key:"resetChartParams",value:function(){this._barNumbers=Math.floor(this._width/this._barWidth),this._barPadding=Math.max(1,Math.round(this._barWidth*pe));var t=this._right_id-this._barNumbers+1;this._left_id=t<0?0:t,this._right_id=this._left_id+this._barNumbers-1,this.sendToServer()}},{key:"get_chart",value:function(t){var e=this.tqsdk.get_by_path("charts/"+me);if(!e||!e.state||e.state.duration!==this._duration||e.state.ins_list!==this._symbol)return null;switch(t){case"left_id":return e.left_id?e.left_id:-1;case"right_id":return e.right_id?e.right_id:-1;default:return e}}},{key:"get_klines_last_id",value:function(){return this.klines&&this.klines.last_id?this.klines.last_id:-1}},{key:"update",value:function(){if(this.get_klines_last_id()>-1)if("day"===this.mainType)-1===this._left_id||-1===this._right_id?(this._left_id=this.get_chart("left_id"),this._right_id=this.get_klines_last_id()):this._right_id=this.get_klines_last_id(),this._barNumbers=this.get_chart("right_id")-this.get_chart("left_id")+1,this._barWidth=this._width/this._barNumbers;else if(-1===this._left_id||-1===this._right_id){var t=this.get_chart("right_id");t&&t>-1&&(this._right_id=t,this._left_id=this._right_id-this._barNumbers+1)}else this._right_id>=this.klines.last_id-1&&(this._right_id=this._right_id+1===this.klines.last_id?this._right_id+1:this._right_id,this._left_id=this._right_id-this._barNumbers+1)}},{key:"moves",value:function(t){if("day"!==this.mainType&&-1!==this._left_id){var e=this._left_id-t,i=e+this._barNumbers-1;if(e>=0&&e<=this.get_klines_last_id()){var n=[e,i];return this._left_id=n[0],this._right_id=n[1],this.sendToServer(),!0}return!1}}},{key:"sendToServer",value:function(){this._symbol&&this._duration&&("day"===this.mainType?this.tqsdk.set_chart({chart_id:me,symbol:this._symbol,duration:this._duration,trading_day_start:0}):this._right_id>-1&&this._right_id!==this.get_klines_last_id()?this.tqsdk.set_chart({chart_id:me,symbol:this._symbol,duration:this._duration,view_width:2*this._barNumbers,left_kline_id:this._left_id-this._barNumbers}):this.tqsdk.set_chart({chart_id:me,symbol:this._symbol,duration:this._duration,view_width:2*this._barNumbers}))}},{key:"width",set:function(t){this._width=t,this.resetChartParams()}},{key:"barWidth",set:function(t){t=t%2===0?t+1:t,t<ge||t>_e||t===this._barWidth||(this._barWidth=t,this.resetChartParams())},get:function(){return this._barWidth}},{key:"barPadding",get:function(){return this._barPadding}},{key:"barNumbers",get:function(){return this._barNumbers}},{key:"symbol",get:function(){return this._symbol},set:function(t){this._symbol!==t&&(this._symbol=t,this._left_id=this._right_id=-1,this.sendToServer())}},{key:"duration",get:function(){return this._duration},set:function(t){this._duration!==t&&(this._duration=t,this._left_id=this._right_id=-1,this.sendToServer())}},{key:"klinesPath",get:function(){return this.symbol&&this.duration?"klines/"+this.symbol+"/"+this.duration:""}},{key:"quote",get:function(){return this._symbol?this.tqsdk.get_quote(this._symbol):null}},{key:"klines",get:function(){return this._symbol&&this._duration?this.tqsdk.get_klines(this._symbol,this._duration):null}},{key:"left_id",get:function(){return this._left_id}},{key:"right_id",get:function(){return this._right_id}}]),t}(),be=ve,ye=de["m"](".%L"),we=de["m"](":%S"),ke=de["m"]("%H:%M"),Ce=de["m"]("%H:%M"),Se=de["m"]("%m%d"),xe=de["m"]("%m%d"),Ee=de["m"]("%y");function De(t){return(de["q"](t)<t?ye:de["o"](t)<t?we:de["n"](t)<t?ke:de["l"](t)<t?Ce:de["p"](t)<t?Se:de["r"](t)<t?xe:Ee)(t)}var Te={up:function(t){return t.open<=t.close},down:function(t){return t.open>t.close}},qe=Object.keys(Te),Oe={up:function(t){return t.open<t.close},down:function(t){return t.open>t.close},equal:function(t){return t.open===t.close}},Ie=Object.keys(Oe),$e=function(){function t(e){Object(he["a"])(this,t),this.name=e.name?e.name:(new Date).getTime(),this.plot=e.plot?e.plot:null,this.chartDm=this.plot.chartDm,this.types=["line","body"]}return Object(le["a"])(t,[{key:"createPaths",value:function(){var t=this;return this.paths=[],Ie.forEach(function(e){return t.paths.push([t.name,"line",e].join("."))}),Ie.forEach(function(e){return t.paths.push([t.name,"body",e].join("."))}),this.paths}},{key:"calcPaths",value:function(t,e,i){var n=this;if(this.plot.yScale&&this.plot.xScale&&this.chartDm){var s={};this.paths.forEach(function(t){return s[t]=""});for(var r=function(t){if(!i[t])return"continue";Ie.forEach(function(e){Oe[e](i[t])&&(s[[n.name,"body",e].join(".")]+=n.bodyPath(i[t],t),s[[n.name,"line",e].join(".")]+=n.linePath(i[t],t))})},a=t;a<=e;a++)r(a);return s}}},{key:"bodyPath",value:function(t,e){var i=Math.round(this.plot.yScale(t.open)),n=Math.round(this.plot.yScale(t.close)),s=this.plot.xScale(e)+this.chartDm.barPadding,r=this.chartDm.barWidth-2*this.chartDm.barPadding,a="";return a=t.open!==t.close?"M ".concat(s," ").concat(i," L ").concat(s+r," ").concat(i," L ").concat(s+r," ").concat(n," L ").concat(s," ").concat(n," L ").concat(s," ").concat(i):"M ".concat(s," ").concat(i+.5," L ").concat(s+r," ").concat(i+.5),a}},{key:"linePath",value:function(t,e){var i=Math.round(this.plot.yScale(t.high)),n=Math.round(this.plot.yScale(t.low)),s=this.plot.xScale(e)+this.chartDm.barWidth/2,r="M ".concat(s," ").concat(i," L ").concat(s," ").concat(n);return r}}]),t}(),Me=$e,Ne=function(){function t(e){Object(he["a"])(this,t),this.name=e.name?e.name:(new Date).getTime(),this.plot=e.plot?e.plot:null,this.chartDm=this.plot.chartDm,this.types=["line","body"]}return Object(le["a"])(t,[{key:"createPaths",value:function(){var t=this;return this.paths=[],Ie.forEach(function(e){return t.paths.push([t.name,"body",e].join("."))}),this.paths}},{key:"calcPaths",value:function(t,e,i){var n=this;if(this.plot.yScale&&this.plot.xScale&&this.chartDm){var s={};this.paths.forEach(function(t){return s[t]=""});for(var r=function(t){if(!i[t])return"continue";Ie.forEach(function(e){Oe[e](i[t])&&(s[[n.name,"body",e].join(".")]+=n.bodyPath(i[t],t))})},a=t;a<=e;a++)r(a);return s}}},{key:"bodyPath",value:function(t,e){var i=this.plot.yScale(t.open),n=this.plot.yScale(t.close),s=this.plot.yScale(t.high),r=this.plot.yScale(t.low),a=this.plot.xScale(e),o=a+this.chartDm.barPadding,c=a+this.chartDm.barWidth/2,h=a+this.chartDm.barWidth-this.chartDm.barPadding,l="M ".concat(o," ").concat(i," L ").concat(c," ").concat(i);return l+="M ".concat(c," ").concat(r," L ").concat(c," ").concat(s),l+="M ".concat(c," ").concat(n," L ").concat(h," ").concat(n),l}}]),t}(),Pe=Ne,je=function(){function t(e){Object(he["a"])(this,t),this.name=e.name?e.name:(new Date).getTime(),this.plot=e.plot?e.plot:null,this.chartDm=this.plot.chartDm}return Object(le["a"])(t,[{key:"createPaths",value:function(){var t=this;return this.paths=[],qe.forEach(function(e){return t.paths.push([t.name,"body",e].join("."))}),this.paths}},{key:"calcPaths",value:function(t,e,i){var n=this;if(this.plot.yScale&&this.plot.xScale&&this.chartDm){var s={};this.paths.forEach(function(t){return s[t]=""});for(var r=function(t){if(!i[t])return"continue";qe.forEach(function(e){Te[e](i[t])&&(s[[n.name,"body",e].join(".")]+=n.bodyPath(i[t],t,"up"===e?0:.5))})},a=t;a<=e;a++)r(a);return s}}},{key:"bodyPath",value:function(t,e,i){var n=Math.floor(this.plot.yScale(0)),s=Math.round(n-this.plot.yScale(t.volume)),r=this.plot.xScale(e)+this.chartDm.barPadding,a=this.chartDm.barWidth-2*this.chartDm.barPadding,o="M ".concat(r+i," ").concat(n-i," L ").concat(r+a-i," ").concat(n-i," L ").concat(r+a-i," ").concat(n-s+i," L ").concat(r+i," ").concat(n-s+i," L ").concat(r+i," ").concat(n-i);return o}}]),t}(),Le=je,Ae=function(){function t(e){Object(he["a"])(this,t),this.name=e.name?e.name:(new Date).getTime(),this.plot=e.plot?e.plot:null,this.chartDm=this.plot.chartDm}return Object(le["a"])(t,[{key:"createPaths",value:function(){return this.paths=["oi"],this.paths}},{key:"calcPaths",value:function(t,e,i){if(this.plot.yScale&&this.plot.xScale&&this.chartDm){for(var n="",s=t;s<=e;s++)if(i[s]){var r=this.plot.yScale(i[s].close_oi),a=this.plot.xScale(s)+this.chartDm.barWidth/2;n+=""===n?"M":"L",n+="".concat(a," ").concat(r," ")}return{oi:n}}}}]),t}(),Fe=Ae,Re=function(){function t(e){Object(he["a"])(this,t),this.name=e.name?e.name:(new Date).getTime(),this.plot=e.plot?e.plot:null,this.chartDm=this.plot.chartDm}return Object(le["a"])(t,[{key:"createPaths",value:function(){return this.paths=["close"],this.paths}},{key:"calcPaths",value:function(t,e,i){if(this.plot.yScale&&this.plot.xScale&&this.chartDm){for(var n="",s=t;s<=e;s++)if(i[s]){var r=this.plot.yScale(i[s].close),a=this.plot.xScale(s)+this.chartDm.barWidth/2;n+=""===n?"M":"L",n+="".concat(a," ").concat(r," ")}return{close:n}}}}]),t}(),We=Re,He=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(he["a"])(this,t),this.calculator=e.calculator,this.name=e.name?e.name:(new Date).getTime(),this.plot=e.plot?e.plot:null,this.chartDm=this.plot.chartDm,this.pathClasses=[],this.type="MAIN"}return Object(le["a"])(t,[{key:"createPaths",value:function(){for(var t=this,e=function(e){var i=t.calculator.paths[e].name,n=t.calculator.paths[e].type;"colorBar"===n?qe.forEach(function(e){t.pathClasses.push([t.name,i,e].join("."))}):"candle"===n?["line","body"].forEach(function(e){Ie.forEach(function(n){t.pathClasses.push([t.name,i,e,n].join("."))})}):t.pathClasses.push([t.name,i].join("."))},i=0;i<this.calculator.paths.length;i++)e(i);return this.pathClasses}},{key:"calcPaths",value:function(e,i,n){var s=this;if(this.plot.yScale&&this.plot.xScale&&this.chartDm){var r={};this.pathClasses.forEach(function(t){return r[t]=""});for(var a=function(n){var a=s.calculator.paths[n].name,o=s.name+"."+s.calculator.paths[n].name,c=s.calculator.paths[n].type;if("line"===c){for(var h=e;h<=i;h++)if(s.calculator[a][h]){var l=s.linePath(s.calculator[a][h],h);r[o]+=""===r[o]?"M ".concat(l):"L ".concat(l)}}else if("bar"===c){for(var u=s.plot.yScale(0),d=e;d<=i;d++)if(s.calculator[a][d]){var m=s.linePath(s.calculator[a][d],u,d);r[o]+=m}}else"colorBar"===c&&function(){for(var n=s.plot.yScale(0),c=function(e){if(!s.calculator[a][e])return"continue";qe.forEach(function(i){if(i(s.chartDm.klines.data[e])){var c=s.linePath(s.calculator[a][e],n,e,"down"===i?t.HollowBarDiff:0);r[o+"."+i]+=c}})},h=e;h<=i;h++)c(h)}()},o=0;o<this.calculator.paths.length;o++)a(o);return r}}},{key:"linePath",value:function(t,e){var i=this.plot.yScale(t),n=this.plot.xScale(e)+this.chartDm.barWidth/2;return"".concat(n," ").concat(i)}},{key:"barPath",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=Math.round(e-this.plot.yScale(t)),r=Math.round(this.plot.xScale(i)+this.chartDm.barPadding),a=this.chartDm.barWidth-2*this.chartDm.barPadding;return"M ".concat(r+n," ").concat(e," L ").concat(r+a-n," ").concat(e," L ").concat(r+a-n," ").concat(e-s," L ").concat(r+n," ").concat(e-s," L ").concat(r+n," ").concat(e)}}]),t}();Object(ue["a"])(He,"HollowBarDiff",.5);var Ge=He,Be=function(){function t(e){Object(he["a"])(this,t),this.id=e.id,this.type=e.type,this.name=e.name,this.xScale=e.xScale,this.yScale=e.yScale,this.chartDm=e.chartDm,this.calculator=e.calculator,this.otherPaths={},this.init()}return Object(le["a"])(t,[{key:"init",value:function(){switch(this.type){case"candle":this.path=new Me({name:this.name,plot:this});break;case"ohlc":this.path=new Pe({name:this.name,plot:this});break;case"day":this.path=new We({name:this.name,plot:this});break;case"volume":this.path=new Le({name:this.name,plot:this});break;case"oi":this.path=new Fe({name:this.name,plot:this});break;default:this.path=new Ge({calculator:this.calculator,name:this.id,plot:this});break}}},{key:"range",value:function(t,e){var i=this.chartDm.klines.slice(t,e+1);switch(this.type){case"ohlc":case"candle":return[de["h"](i,function(t){return t&&t["low"]}),de["g"](i,function(t){return t&&t["high"]})];case"day":return de["f"](i,function(t){return t&&t["close"]});case"volume":return[0,de["g"](i,function(t){return t&&t["volume"]})];case"oi":return de["f"](i,function(t){return t&&t["close_oi"]});default:return this.path.calculator.calc(t,e,this.chartDm.klines),this.path.calculator.range(t,e)}}},{key:"draw",value:function(){}},{key:"destroy",value:function(){}},{key:"showIndicator",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var i in this.indicators)i===t&&this.g.selectAll("path.".concat(i)).attr("visibility",e?"visible":"hidden")}}]),t}(),Ue=Be,Ye=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ";return t.length?t.join(e):""},Ze=function(){function t(e){Object(he["a"])(this,t),this.xScale=e.xScale,this.chartDm=e.chartDm,this.type=e.type,this.parentG=e.parentG,this.name=e.name,this._height=e.height,this._width=e.width,this._top=e.top?e.top:0,this._left=e.left?e.left:0,this.g=this.parentG.append("g").attr("class",this.name).attr("transform","translate("+this._left+","+this._top+")"),this.yAlign="left"===e.align?"left":"right",this.initYAxis(),this.plots={}}return Object(le["a"])(t,[{key:"initYAxis",value:function(){this.yScale=de["j"]().range([this._height,0]),"left"===this.yAlign?this.yAxis=de["b"]().scale(this.yScale):this.yAxis=de["c"]().scale(this.yScale),this.ySvg=this.g.append("g").attr("class","y axis"),"right"===this.yAlign&&this.ySvg.attr("transform","translate("+this._width+",0)")}},{key:"updateYAxis",value:function(t){this.yScale.domain(t),this.ySvg.call(this.yAxis)}},{key:"top",value:function(t){return t&&(this._top=t,this.g.attr("transform","translate("+this._left+","+this._top+")")),this._top}},{key:"left",value:function(t){return t&&(this._left=t,this.g.attr("transform","translate("+this._left+","+this._top+")")),this.g.left()}},{key:"height",value:function(t){return t&&(this._height=t,this.g.attr("height",this._height),this.yScale.range([this._height,0])),this._height}},{key:"width",value:function(t){return t&&(this._width=t,this.g.attr("width",this._width),"right"===this.yAlign&&this.ySvg.attr("transform","translate("+this._width+",0)")),this._width}},{key:"appendPlotTypePath",value:function(t){Array.isArray(t)||(t=t.split(".")),this.g.selectAll("path.".concat(Ye(t,"."))).data(function(t){return[t]}).enter().append("path").attr("class","".concat(Ye(t," ")))}},{key:"addPlot",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.plots[e.id]=new Ue({id:e.id,type:e.type,name:e.name,calculator:e.calculator,xScale:this.xScale,yScale:this.yScale,chartDm:this.chartDm}),this.plots[e.id].path&&this.plots[e.id].path.createPaths().forEach(function(e){t.appendPlotTypePath(e.split("."))})}},{key:"showPlot",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(var i in this.plots)i===t&&this.g.selectAll("path.".concat(i)).attr("visibility",e?"visible":"hidden")}},{key:"removePlot",value:function(t){this.plots[t].destroy(),this.g.selectAll("path.".concat(t)).attr("visibility","hidden"),delete this.plots[t]}},{key:"draw",value:function(t,e){var i=[1/0,-1/0];for(var n in this.plots){var s=this.plots[n],r=s.range(t,e);i[0]=Math.min(r[0],i[0]),i[1]=Math.max(r[1],i[1])}for(var a in this.updateYAxis(i),this.plots)if(!(a in["candle","ohlc","day"]&&a!==this.type)){var o=this.plots[a],c=o.path.calcPaths(t,e,this.chartDm.klines);for(var h in c)this.g.select("path.".concat(h)).attr("d",c[h])}}}]),t}(),ze=Ze,Je=function(){function t(e){Object(he["a"])(this,t),this.parentG=e.parentG,this.name=e.name,this.g=this.parentG.append("g").attr("class",this.name),this._text="正在加载数据",this._isShow=!!e.show&&e.show,this.textG=this.g.append("text").attr("x","50%").attr("y","50%").attr("text-anchor","middle").attr("font-size",50).text(this._text).attr("visibility",this._isShow?"visible":"hidden")}return Object(le["a"])(t,[{key:"show",get:function(){return this._isShow},set:function(t){this._isShow=!!t,this.textG.attr("visibility",this._isShow?"visible":"hidden")}},{key:"text",get:function(){return this._text},set:function(t){this._text=String(t),this.textG.text(this._text)}}]),t}(),Qe=i("3835"),Xe=(i("7cdf"),function(t){return Number.isInteger(t)?function(e){return e&&e.toFixed?e.toFixed(t):e}:function(t){return t}}),Ve=function(t){var e=null;if("number"===typeof t){e=t>1e12&&t<3e12?new Date(t):new Date(t/1e6);var i=e.getFullYear()+"",n=(e.getMonth()+1+"").padStart(2,"0"),s=(e.getDate()+"").padStart(2,"0"),r=(e.getHours()+"").padStart(2,"0"),a=(e.getMinutes()+"").padStart(2,"0"),o=(e.getSeconds()+"").padStart(2,"0");(e.getMilliseconds()+"").padStart(3,"0");return"00"===r&&"00"===a&&"00"===o?"".concat(i,"/").concat(n,"/").concat(s," (").concat(e.getDay(),")"):"".concat(i,"/").concat(n,"/").concat(s,"-").concat(r,":").concat(a,":").concat(o)}return e},Ke=function(){function t(e){Object(he["a"])(this,t),this.parentG=e.parentG,this.name=e.name,this._top=e.top?e.top:0,this._left=e.left?e.left:0,this._height=e.height?e.height:0,this._width=e.width?e.width:0,this.chartDm=e.chartDm,this.g=this.parentG.append("g").attr("class",this.name).attr("transform","translate("+this._left+","+this._top+")").attr("height",this._height).attr("width",this._width),this._isShow=!e.show||e.show,this.g.attr("visibility",this._isShow?"visible":"hidden");var i=this;this.g.selectAll("rect").data([0]).enter().append("rect").attr("width",this._width).attr("height",this._height).attr("fill-opacity",0).on("mouseover",function(){i.show()}).on("mousemove",function(){var t=de["i"](this),e=Object(Qe["a"])(t,2),n=e[0],s=e[1],r=Math.floor(n/i.chartDm.barWidth),a=r*i.chartDm.barWidth+i.chartDm.barWidth/2;if(i.chartDm.klines){var o=i.chartDm.klines[i.chartDm.left_id+r];if(o){var c=i.chartDm.quote.price_decs,h=Xe(c),l=[Ve(o.datetime),"高 "+h(o.high),"开 "+h(o.open),"低 "+h(o.low),"收 "+h(o.close)],u=i.g.selectAll("g.text text"),d=u.selectAll("tspan").data(l);d.exit().remove(),d.enter().append("tspan").merge(d).attr("x","-4em").attr("dy","1em").text(function(t){return t});var m=i.g.select("g.axisannotation.x text");i.g.select("g.axisannotation.y text");m.text(De(o.datetime/1e6)),m.attr("x",a).attr("y",i._height+16),i.g.select("g.axisannotation.x rect").attr("x",a).attr("y",i._height+4)}}var p=i.g.select("g.crosshair.horizontal line"),f=i.g.select("g.crosshair.vertical line");p.attr("y1")!==s&&p.attr("y1",s).attr("y2",s),f.attr("x1")!==a&&f.attr("x1",a).attr("x2",a)}).on("mouseleave",function(){i.hide()}),this.g.append("g").attr("class","crosshair horizontal").append("line").attr("x1",0).attr("y1",0).attr("x2",this._width).attr("y2",0).attr("stroke","#bbbbbb").attr("stroke-dasharray","2 4").attr("visibility","hidden"),this.g.append("g").attr("class","crosshair vertical").append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",this._height).attr("stroke","#bbbbbb").attr("stroke-dasharray","2 4").attr("visibility","hidden"),this.g.append("g").attr("class","text").append("text").attr("fill","grey").attr("x",0).attr("y",0),this.g.append("g").attr("class","axisannotation x"),this.g.select("g.axisannotation.x").append("rect").attr("fill","#eeeeee").attr("opacity","0.8").attr("width","40px").attr("height","16px"),this.g.select("g.axisannotation.x").append("text").attr("fill","white"),this.g.append("g").attr("class","axisannotation y").append("text")}return Object(le["a"])(t,[{key:"top",value:function(t){return t&&(this._top=t,this.g.attr("transform","translate("+this._left+","+this._top+")")),this._top}},{key:"left",value:function(t){return t&&(this._left=t,this.g.attr("transform","translate("+this._left+","+this._top+")")),this._left}},{key:"height",value:function(t){return t&&(this._height=t,this.g.select("g.crosshair.vertical line").attr("y2",t),this.g.select("rect").attr("height",t)),this._height}},{key:"width",value:function(t){return t&&(this._width=t,this.g.select("g.crosshair.horizontal line").attr("x2",t),this.g.select("rect").attr("width",t)),this._width}},{key:"show",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.g.selectAll("g.crosshair line").attr("visibility",t?"visible":"hidden")}},{key:"hide",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.g.selectAll("g.crosshair line").attr("visibility",t?"visible":"hidden")}}]),t}();function ti(t,e,i){for(var n=0,s=i-e+1;s<=i&&!isNaN(n);s++)n+=t[s];return n}function ei(t,e,i,n){return 0!=n.length&&n[t-1]?n[t-1]-e[t-i]/i+e[t]/i:ti(e,i,t)/i}function ii(t,e,i,n){n._s=n._s?n._s:[];var s=0,r=0;if(n._s[t-1])r=n._s[t-1][0]-e[t-i]+e[t],s=n._s[t-1][1]-e[t-i]*e[t-i]+e[t]*e[t];else for(var a=t-i+1;a<=t;a++){var o=e[a];s+=o*o,r+=o}var c=s-r*r/i;c<0&&c>-1e-6&&(c=Math.abs(c));var h=1==i?1:i-1,l=Math.sqrt(c/h);return isNaN(l)||(n._s[t]=[r,s]),l}var ni=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(he["a"])(this,t),this.params=e.params?e.params:5,this.paths=[{name:"ma",type:"line"}],this.ma=[]}return Object(le["a"])(t,[{key:"calc",value:function(t,e,i){for(var n=t;n<=e;n++)this.ma[n]||(this.ma[n]=ei(n,i.close,this.params,this.ma));return this.ma}},{key:"range",value:function(t,e){for(var i=NaN,n=NaN,s=t;s<=e;s++)this.ma[s]&&(n=n?Math.max(n,this.ma[s]):this.ma[s],i=i?Math.min(i,this.ma[s]):this.ma[s]);return[i,n]}}]),t}(),si=ni,ri=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(he["a"])(this,t),this.n=e.pramas&&e.pramas.n?e.pramas.n:10,this.p=e.pramas&&e.pramas.p?e.pramas.p:3,this.paths=[{name:"top",type:"line"},{name:"bottom",type:"line"}],this._mid=[],this._std=[],this.top=[],this.bottom=[]}return Object(le["a"])(t,[{key:"calc",value:function(t,e,i){for(var n=t;n<=e;n++)this.top[n]&&this.bottom[n]||(this._mid[n]=ei(n,i.close,this.n,this._mid),this._std[n]=ii(n,i.close,this.n,this._std),this.top[n]=this._mid[n]+this.p*this._std[n],this.bottom[n]=this._mid[n]-this.p*this._std[n]);return{top:this.top,bottom:this.bottom}}},{key:"range",value:function(t,e){for(var i=NaN,n=NaN,s=t;s<=e;s++)this.top[s]&&this.bottom[s]&&(n=n?Math.max(n,this.top[s]):this.top[s],i=i?Math.min(i,this.bottom[s]):this.bottom[s]);return[i,n]}}]),t}(),ai=ri,oi=3,ci=50,hi=80,li=function(){function t(e,i,n){Object(he["a"])(this,t),this._height=i,this._width=n,this._plotsNumber=e||2,this.positions=[],this.initLayout()}return Object(le["a"])(t,[{key:"initLayout",value:function(){var e=1/this.plotsNumber,i=e+.3*e*(this.plotsNumber-1),n=.7*e,s=this.height-t.PLOT_PADDING*(this.plotsNumber-1);this.positions[0]={width:this._width,height:s*i,top:0};for(var r=1;r<this.plotsNumber;r++)this.positions[r]={width:this._width,height:s*n,top:this.positions[r-1].top+this.positions[r-1].height+t.PLOT_PADDING}}},{key:"width",set:function(t){this._width=t,this.initLayout()},get:function(){return this._width}},{key:"height",set:function(t){this._height=t,this.initLayout()},get:function(){return this._height}},{key:"plotsNumber",set:function(t){this._plotsNumber=t,this.initLayout()},get:function(){return this._plotsNumber}}]),t}();Object(ue["a"])(li,"PLOT_PADDING",2);var ui=function(){function t(e){Object(he["a"])(this,t),this.divDomId=e.id,this.outerWidth=e.width,this.outerHeight=e.height,this.margin=e.margin?e.margin:{top:10,right:50,bottom:30,left:50},this.innerWidth=this.outerWidth-this.margin.left-this.margin.right,this.innerHeight=this.outerHeight-this.margin.top-this.margin.bottom,this._symbol=e.symbol?e.symbol:e.instrumentId?e.instrumentId:"",this._duration=e.duration?e.duration:"",this.chartDm=new be({tqsdk:e.tqsdk,symbol:this._symbol,duration:this._duration,width:this.innerWidth}),this.init(),this.indicators={},this.plotsManager=new li(2,this.innerHeight,this.innerWidth),this.mainChart=new ze({xScale:this.xScale,chartDm:this.chartDm,type:"candle",parentG:this.rootG,width:this.innerWidth,height:this.plotsManager.positions[0].height,top:this.plotsManager.positions[0].top,left:0}),this.mainChart.addPlot({id:"candle",type:"candle",name:"candle"}),this.mainChart.addPlot({id:"ohlc",type:"ohlc",name:"ohlc"}),this.mainChart.addPlot({id:"day",type:"day",name:"day"}),this.mainChart.showPlot("ohlc",!1),this.mainChart.showPlot("day",!1),this.subCharts={volume:new ze({name:"volume",type:"volume",xScale:this.xScale,chartDm:this.chartDm,parentG:this.rootG,width:this.innerWidth,height:this.plotsManager.positions[1].height,top:this.plotsManager.positions[1].top,left:0}),oi:new ze({name:"oi",type:"oi",xScale:this.xScale,chartDm:this.chartDm,parentG:this.rootG,align:"left",width:this.innerWidth,height:this.plotsManager.positions[1].height,top:this.plotsManager.positions[1].top,left:0})},this.subCharts["volume"].addPlot({id:"volume",type:"volume",name:"volume"}),this.subCharts["oi"].addPlot({id:"oi",type:"oi",name:"oi"})}return Object(le["a"])(t,[{key:"init",value:function(){this.svg=de["k"]("#"+this.divDomId).append("svg").attr("width",this.outerWidth).attr("height",this.outerHeight),this.rootG=this.svg.append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.loading=new Je({parentG:this.svg,name:"loading",show:!0}),this.xScale=de["j"](),this.xAxis=de["a"]().scale(this.xScale),this.rootG.append("g").attr("class","x axis").attr("transform","translate("+this.chartDm.barWidth/2+","+(this.innerHeight+.5)+")"),this.crosshair=new Ke({parentG:this.svg,name:"crosshair",width:this.innerWidth,height:this.innerHeight,left:this.margin.left,top:this.margin.top,chartDm:this.chartDm});var t=null,e=this,i=de["d"]().on("start",function(){t=de["e"].x,e.crosshair.hide()}).on("drag",function(){var i=Math.round((de["e"].x-t)/e.chartDm.barWidth);Math.abs(i)>0&&(t=de["e"].x,e.move(i))}).on("end",function(){t=null,e.crosshair.show()});this.svg.call(i);var n=0,s=de["s"]().on("zoom",function(){if(n+=de["e"].sourceEvent.deltaY,Math.abs(n)>=oi){var t=Math.round(Math.abs(n)/oi);t=n>0?t:-t,e.debounce(e.zoom,200).bind(e)(t),n=0}});this.svg.call(s).on("dblclick.zoom",null)}},{key:"update",value:function(){this.chartDm.update(),this.draw()}},{key:"width",value:function(t){if(void 0===t)return this.outerWidth;if(t<this.margin.left+this.margin.right+hi)return this.outerWidth;for(var e in this.outerWidth=t,this.innerWidth=this.outerWidth-this.margin.left-this.margin.right,this.svg.attr("width",this.outerWidth),this.chartDm.width=this.innerWidth,this.plotsManager.width=this.innerWidth,this.mainChart.width(this.plotsManager.positions[0].width),this.subCharts)this.subCharts[e].width=this.plotsManager.positions[1].width;this.crosshair.width(this.innerWidth)}},{key:"height",value:function(t){if(void 0===t)return this.outerHeight;if(!(t<this.margin.top+this.margin.bottom+ci)){for(var e in this.outerHeight=t,this.innerHeight=this.outerHeight-this.margin.top-this.margin.bottom,this.svg.attr("height",this.outerHeight),this.plotsManager.height=this.innerHeight,this.mainChart.height(this.plotsManager.positions[0].height),this.mainChart.top(this.plotsManager.positions[0].top),this.subCharts)this.subCharts[e].height(this.plotsManager.positions[1].height),this.subCharts[e].top(this.plotsManager.positions[1].top);this.crosshair.height(this.innerHeight)}}},{key:"symbol",value:function(t){if(void 0===t)return this._symbol;this._symbol=t,this.chartDm.symbol=t,setTimeout(this.draw.bind(this),0)}},{key:"duration",value:function(t){if(void 0===t)return this._duration;this._duration=t,this.chartDm.duration=t,setImmediate(this.draw.bind(this))}},{key:"debounce",value:function(t,e){var i=null;return function(){var n=this,s=arguments;clearTimeout(i),i=setTimeout(function(){t.apply(n,s)},e)}}},{key:"addIndicator",value:function(t){var e=t.id;switch(this.indicators[e]=t,t.name){case"ma":this.indicators[e].calculator=new si(t);break;case"boll":this.indicators[e].calculator=new ai(t);break}this.mainChart.addPlot(this.indicators[e])}},{key:"setMainChartType",value:function(t){this.mainChart.type=t,"day"===t&&(this._duration=6e10,this.chartDm.duration=6e10,setImmediate(this.draw.bind(this)))}},{key:"showPlot",value:function(t){this.mainChart.showPlot(t.id,t.show)}},{key:"move",value:function(t){"day"!==this.mainChart.type&&(this.chartDm.moves(t),this.draw())}},{key:"zoom",value:function(t){var e=this.chartDm.barWidth;this.chartDm.barWidth-=t,e!==this.chartDm.barWidth&&this.draw()}},{key:"drawXAxis",value:function(){this.xScale.domain([this.chartDm.left_id,this.chartDm.right_id]),this.xScale.rangeRound([0,this.chartDm.barNumbers*this.chartDm.barWidth-this.chartDm.barWidth]),this.rootG.selectAll("g.x.axis").attr("transform","translate("+this.chartDm.barWidth/2+","+(this.innerHeight+.5)+")");var t=this.chartDm.klines;this.xAxis.tickFormat(function(e,i){return t[e]&&t[e].datetime?De(t[e].datetime/1e6):""}),this.rootG.selectAll("g.x.axis").call(this.xAxis)}},{key:"draw",value:function(){if(console.log("draw",this.chartDm.left_id,this.chartDm.right_id),-1===this.chartDm.left_id||-1===this.chartDm.right_id)return!1;for(var t in this.loading.show&&(this.loading.show=!1),this.drawXAxis(),this.mainChart.draw(this.chartDm.left_id,this.chartDm.right_id),this.subCharts)this.subCharts[t].draw(this.chartDm.left_id,this.chartDm.right_id)}}]),t}(),di=ui,mi={"5s":5e9,"1m":6e10,"5m":3e11,"15m":9e11,"30m":18e11,"1H":36e11,"1D":864e11},pi={name:"Chart",data:function(){return{width:this.$root.windowWidth,periods:Object.keys(mi),selectedPeriod:"1m",selectedItem:"candle",indicators:{ma3:{id:"ma3",name:"ma",type:"ma",params:3,show:!0},ma10:{id:"ma10",name:"ma",type:"ma",params:10,show:!0},ma30:{id:"ma30",name:"ma",type:"ma",params:30,show:!0},boll:{id:"boll",name:"boll",type:"boll",params:{n:3,p:5},show:!0}}}},computed:{duration:function(){return mi[this.selectedPeriod]}},props:{instrumentId:{type:String,required:!0,default:"KQ.m@CFFEX.IF"},height:{type:Number,required:!0,default:400}},methods:{onchange:function(t){this.chart.showPlot(this.indicators[t])},onSelectedItem:function(t){this.chart.showPlot({id:this.selectedItem,show:!1}),this.selectedItem=t,this.chart.showPlot({id:t,show:!0})},keyUpHandler:function(t){"Escape"===t.key&&this.$router.go(-1)},goBack:function(){this.$router.go(-1)},update:function(){console.log("vue update"),this.chart&&this.chart.update()}},watch:{instrumentId:{handler:function(t,e){"charts"===this.$route.name&&(this.$tqsdk.subscribe_quote([this.instrumentId]),this.chart&&this.chart.symbol(t))},immediate:!0},duration:{handler:function(t,e){this.chart&&this.chart.duration(t)},immediate:!0},height:{handler:function(t,e){this.chart&&(this.chart.height(this.$refs.CHART.clientHeight),this.chart.draw())},immediate:!0}},beforeDestroy:function(){document.removeEventListener("keyup",this.keyUpHandler,!0)},mounted:function(){document.addEventListener("keyup",this.keyUpHandler,!0),this.$on("tqsdk:rtn_data",this.update),this.$on("global:resize",function(){this.chart.height(this.$refs.CHART.clientHeight),this.chart.width(this.$refs.CHART.clientWidth),this.chart.draw()}),this.$nextTick(function(){var t=this.$refs.CHART.clientHeight,e=this.$refs.CHART.clientWidth,i={top:20,right:50,bottom:20,left:50};for(var n in this.chart=new di({id:"CHART",width:e,height:t,margin:i,tqsdk:this.$tqsdk,instrumentId:this.instrumentId,duration:this.duration,mainPlotType:"candle"}),this.indicators)this.chart.addIndicator(this.indicators[n])})}},fi=pi,_i=(i("cd60"),Object(c["a"])(fi,oe,ce,!1,null,null,null));_i.options.__file="index.vue";var gi=_i.exports,vi={components:{Chart:gi},computed:{instrumentId:function(){return this.$route.params.instrument_id},height:function(){return this.$root.windowHeight*this.$root.appSplit}}},bi=vi,yi=(i("3b91"),Object(c["a"])(bi,re,ae,!1,null,"eda8047e",null));yi.options.__file="Charts.vue";var wi=yi.exports,ki=[{id:"主连",func:function(t){return"FUTURE_CONT"===t.class}},{id:"指数",func:function(t){return"FUTURE_INDEX"===t.class}},{id:"金融",func:function(t){return["IH","IF","IC","T","TF"].includes(t.product_id)||["CFFEX.IH","CFFEX.IF","CFFEX.IC","CFFEX.T","CFFEX.TF"].includes(t.underlying_product)}},{id:"金银",func:function(t){return["au","ag"].includes(t.product_id)||["SHFE.au","SHFE.ag"].includes(t.underlying_product)}},{id:"铜铝铅锌",func:function(t){return["al","cu","ni","pb","sn","zn"].includes(t.product_id)||["SHFE.al","SHFE.cu","SHFE.ni","SHFE.pb","SHFE.sn","SHFE.zn"].includes(t.underlying_product)}},{id:"双焦",func:function(t){return["j","jm"].includes(t.product_id)||["DCE.j","DCE.jm"].includes(t.underlying_product)}},{id:"钢铁",func:function(t){return["SF","SM","hc","i","rb"].includes(t.product_id)||["CZCE.SF","CZCE.SM","SHFE.hc","DCE.i","SHFE.rb"].includes(t.underlying_product)}},{id:"煤炭",func:function(t){return["ZC","j","jm"].includes(t.product_id)||["CZCE.ZC","DCE.j","DCE.jm"].includes(t.underlying_product)}},{id:"化工",func:function(t){return["MA","TA","bu","l","pp","ru","v"].includes(t.product_id)||["CZCE.MA","CZCE.TA","SHFE.bu","DCE.l","DCE.pp","SHFE.ru","DCE.v"].includes(t.underlying_product)}},{id:"油脂",func:function(t){return["OI","p","y"].includes(t.product_id)||["CZCE.OI","DCE.p","DCE.y"].includes(t.underlying_product)}},{id:"软商品",func:function(t){return["CF","CY","SR"].includes(t.product_id)||["CZCE.CF","CZCE.CY","CZCE.SR"].includes(t.underlying_product)}},{id:"谷物",func:function(t){return["JR","LR","RI","WH","a","c"].includes(t.product_id)||["CZCE.JR","CZCE.LR","CZCE.RI","CZCE.WH","DCE.a","DCE.c"].includes(t.underlying_product)}},{id:"农副",func:function(t){return["cs","jd"].includes(t.product_id)||["DCE.cs","DCE.jd"].includes(t.underlying_product)}},{id:"饲料",func:function(t){return["RM","c","m"].includes(t.product_id)||["CZCE.RM","DCE.c","DCE.m"].includes(t.underlying_product)}},{id:"建材",func:function(t){return["FG","rb"].includes(t.product_id)||["CZCE.FG","SHFE.rb"].includes(t.underlying_product)}}],Ci={};for(var Si in ki)Ci[ki[Si].id]=[];var xi=ki;n["default"].use(u["a"]);var Ei=new u["a"]({routes:[{path:"/quotes/:tag",name:"quotes",components:{quotes:ht,user:se}},{path:"/charts/:instrument_id",name:"charts",components:{quotes:wi,user:se}},{path:"/*",redirect:"/quotes/"+xi[0].id}]}),Di=(i("55dd"),{SET_BROKERS:function(t,e){t.brokers=e},SET_TAGS_QOUTES_MAP:function(t,e){var i={};for(var n in e){var s=e[n];if(!s.expired)for(var r in xi){var a=xi[r];a.func(s)&&(i[a.id]?i[a.id].push(n):i[a.id]=[n])}}for(var o in i)i[o].sort(function(t,i){var n=e[t].sort_key-e[i].sort_key;return 0===n?e[t].ins_id-e[i].ins_id:n});t.tagsQuotesMap=i},SET_LOGIN:function(t,e){t.logined=e},SET_SETTLEMENT:function(t,e){t.confirm="doing",t.confirmContent=e["content"]},SET_WS_CONNECT_STATUS:function(t,e){Object.assign(t,e)},SET_SELECTED_SYMBOL:function(t,e){t.selectSymbol=e},SET_SELECTED_SHOW_SYMBOL:function(t,e){t.selectShowSymbol=e}}),Ti={getSelectedInstrumentId:function(t,e){return t.selectSymbol},getSelectedShowInstrumentId:function(t,e){return t.selectShowSymbol}};n["default"].use(f["a"]);var qi=new f["a"].Store({state:{bid:"",user_id:"",logined:!1,confirm:"done",confirmContent:"",selectShowSymbol:"KQ.m@CFFEX.IF",selectSymbol:"",quoteWsConnected:!1,tradeWsConnected:!1,ins_list:[],tags:xi.map(function(t){return t.id}),tagsQuotesMap:Ci},mutations:Di,getters:Ti}),Oi=qi,Ii=i("e069"),$i=i.n(Ii);i("dcad");n["default"].use($i.a,{transfer:!0,size:"small"});i("ffc1"),i("20d6");var Mi=i("01a2"),Ni=i.n(Mi),Pi=new Ni.a({symbolsServerUrl:"https://openmd.shinnytech.com/t/md/symbols/latest.json",wsQuoteUrl:"wss://openmd.shinnytech.com/t/md/front/mobile",wsTradeUrl:"wss://otg-sim.shinnytech.com/trade?access_token=eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJobi1MZ3ZwbWlFTTJHZHAtRmlScjV5MUF5MnZrQmpLSFFyQVlnQ0UwR1JjIn0.eyJqdGkiOiJkYzEzMzBkYS1lMWZkLTQzYTItOWU3Ny1hNWE5M2U3NWY2YzEiLCJleHAiOjE2MTI0MDMwNDgsIm5iZiI6MCwiaWF0IjoxNTgwODY3MDQ4LCJpc3MiOiJodHRwczovL2F1dGguc2hpbm55dGVjaC5jb20vYXV0aC9yZWFsbXMvc2hpbm55dGVjaCIsInN1YiI6IjRiYjJhMGRjLTI2ZDEtNDNmNS05ZDY3LTk5ZGM1ZGRhOGNmZSIsInR5cCI6IkJlYXJlciIsImF6cCI6InNoaW5ueV93ZWIiLCJhdXRoX3RpbWUiOjAsInNlc3Npb25fc3RhdGUiOiI2Y2Y4NzZhZS1jOGQ0LTRlMWEtYjFlNS00Mjk5NTI2ZTZhYjkiLCJhY3IiOiIxIiwic2NvcGUiOiJhdHRyaWJ1dGVzIiwiZ3JhbnRzIjp7ImZlYXR1cmVzIjpbIiJdLCJhY2NvdW50cyI6WyIqIl19fQ.Doy459Bacf4RzJDU5g_wxaKa9S736AHx8DSoBI3qOKnNuq8exCDqCgk6fxhwlfnzm_dJhMGi-VS8SquqrT3U00wB_ODJ0GN7HqVUdiXxKLKNwL7d3vqPHKqtEq0srVYDMZ6wGWQj8v7jjv0omeqt9Y1OZvjNC9pOo_Jb44umYcfGXQMdPbUtN1IxL_YosVdiTblHaDymaFrx7qiJWDT0pXBacysA2_rhG1mBlRkd0GYmiu07giXhNW_ZCyvXne5t1bMDC53mxByzqKXILNUvp4c3j0FkoVVdUyLkac4wZMREzZmchWfy5OpH9PvCfpnc-CS-ZPDB_XAQVAXkuf2TeQ",reconnectInterval:3e3,reconnectMaxTimes:5,prefix:"web"});window.tqsdk=Pi;var ji=Number(n["default"].version.split(".")[0]),Li=function(){},Ai={},Fi={},Ri=/^global:/,Wi={},Hi=/^tqsdk:/;function Gi(t){var e=t.prototype.$on,i=t.prototype.$emit;t.prototype.$on=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Li,n=this;if(Array.isArray(t))t.forEach(function(t){return n.$on(t,i)});else if(Ri.test(t))(Fi[n._uid]||(Fi[n._uid]=[])).push(t),(Ai[t]||(Ai[t]=[])).push(n),e.call(n,t,i);else if(Hi.test(t)){Wi[n._uid]||(Wi[n._uid]={});var s=t.match(/^tqsdk:(.*)/)[1];Wi[n._uid][s]||(Wi[n._uid][s]=[]);var r=i.bind(n);Wi[n._uid][s].push(r),Pi.on(s,r)}else e.call(n,t,i);return n},t.prototype.$emit=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];var r=this;if(Ri.test(t)){var a=Ai[t]||[];a.forEach(function(e){return i.apply(e,[t].concat(n))})}else i.apply(r,[t].concat(n));return r}}function Bi(t){t.mixin({beforeDestroy:function(){var t=this,e=Fi[t._uid]||[];e.forEach(function(e){var i=Ai[e].findIndex(function(e){return e._uid===t._uid});Ai[e].splice(i,1)}),delete Fi[t._uid];var i=Wi[t._uid]||{},n=function(t){var e=i[t];e.forEach(function(e){Pi.removeEventListener(t,e)})};for(var s in i)n(s);delete Wi[t._uid],Object.entries(Ai).forEach(function(t){var e=Object(Qe["a"])(t,2),i=e[0],n=e[1];return n.length||delete Ai[i]})}})}function Ui(t){ji<2?console.error("[vue-event-proxy] only support Vue 2.0+"):Ui.installed||(Ui.installed=!0,Gi(t),Bi(t))}n["default"].use(Ui),n["default"].$tqsdk=Pi,n["default"].prototype.$tqsdk=Pi;var Yi=Pi;Yi.on("ready",function(){Oi.commit("SET_TAGS_QOUTES_MAP",Yi.quotesInfo)}),Yi.on("error",function(){n["default"].prototype.$Message.error("获取合约列表失败，请检查网络后刷新页面。")}),n["default"].config.productionTip=!1,n["default"].config.errorHandler=function(t,e,i){console.error(t,e,i)},n["default"].filter("toPercent",function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=Number(t);return Number.isFinite(i)?i.toFixed(e):t});var Zi={name:"tianqin-web",windowHeight:window.innerHeight,windowWidth:window.innerWidth,appSplit:.6},zi=new n["default"]({data:Zi,router:Ei,store:Oi,render:function(t){return t(l)},methods:{handlerResize:function(){Zi.windowHeight=window.innerHeight,Zi.windowWidth=window.innerWidth,this.$emit("global:resize")}},created:function(){var t;function e(){t||(t=setTimeout(function(){t=null,zi.handlerResize()},66))}window.addEventListener("resize",e,!1)}}).$mount("#app")},"5c0b":function(t,e,i){"use strict";var n=i("5e27"),s=i.n(n);s.a},"5d5a":function(t,e,i){},"5e27":function(t,e,i){},"6bfa":function(t,e,i){},"819c":function(t,e,i){},"823b":function(t,e,i){},8669:function(t,e,i){},"966f":function(t,e,i){"use strict";var n=i("a436"),s=i.n(n);s.a},"9bac":function(t,e,i){"use strict";var n=i("3170"),s=i.n(n);s.a},a436:function(t,e,i){},ab6f:function(t,e,i){"use strict";var n=i("491c"),s=i.n(n);s.a},bfab:function(t,e,i){"use strict";var n=i("2568"),s=i.n(n);s.a},c107:function(t,e,i){"use strict";var n=i("5d5a"),s=i.n(n);s.a},c942:function(t,e,i){"use strict";var n=i("e6b1"),s=i.n(n);s.a},cd60:function(t,e,i){"use strict";var n=i("f193"),s=i.n(n);s.a},e6b1:function(t,e,i){},e86d:function(t,e,i){"use strict";var n=i("8669"),s=i.n(n);s.a},f193:function(t,e,i){},f6c8:function(t,e,i){"use strict";var n=i("823b"),s=i.n(n);s.a}});